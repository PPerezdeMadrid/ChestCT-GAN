# Pipeline de MLOPS con Metaflow y Kubernetes

## Instrucciones para ejecutar el pipeline

### Antes de empezar

1. AsegÃºrate de tener los archivos descargados del dataset NBIA (TCIA) en tu mÃ¡quina.
\(https://www.cancerimagingarchive.net/collection/lung-pet-ct-dx/) El archivo se llama `Lung-PET-CT-Dx-NBIA-Manifest-122220.tcia`. Si no puedes descargarlo con la herramienta *NBIA Data Retriever* prueba a hacerlo con la librerÃ­a `nbiatoolkit` de python.

2. En el archivo `main_pipeline.py`, localiza la siguiente lÃ­nea de cÃ³digo:

```python
dataset_path = "../../../../ChestCT-NBIA/manifest-1608669183333"  # CAMBIAR !!
```

3. **Â¡Importante!** Cambia el valor de `dataset_path` para que apunte a la carpeta donde se encuentran los archivos descargados del dataset.

### EjecuciÃ³n del pipeline
```bash
cd src/Pipeline
python main_pipeline.py run
```

---

## Estructura del directorio 

```bash
ğŸ“‚ Pipeline
â”‚-- ğŸ“‚ Data                  # Datos utilizados para entrenamiento
â”‚-- ğŸ“‚ GAN_PyTorch           # ImplementaciÃ³n de las arquitecturas GAN en PyTorch
â”‚-- ğŸ“‚ model                 # * Modelos entrenados y checkpoints 
â”‚-- ğŸ“‚ images                # * ImÃ¡genes generadas por el modelo
â”‚-- ğŸ“‚ evaluation            # * Archivos sobre la evaluaciÃ³n de los checkpoints
â”‚-- ğŸ“„ README.md             # Este archivo
â”‚-- ğŸ“„ requirements.txt      # Dependencias necesarias para ejecutar el proyecto
â”‚-- ğŸ“„ pipeline.md           # DescripciÃ³n de la pipeline de datos
â”‚-- ğŸ“„ template_EvalModel.md # Plantilla para la evaluaciÃ³n del modelo
â”‚-- ğŸ“„ main_pipeline.py      # Script principal del pipeline de Metaflow
â”‚-- ğŸ“„ Pipeline.png          # Diagrama del pipeline

Nota*: Se genera automÃ¡ticamente con el pipeline
```

```bash
python3 main_pipeline.py show 
Metaflow 2.13.9 executing ChestGAN for user:palomaperezdemadrid



Step start
    SelecciÃ³n de ImÃ¡genes para el modelo 
    => train_model

Step train_model
    Entrenar el modelo 
    => eval_model

Step eval_model
    Evaluar el modelo 
    => generate_imgs

Step generate_imgs
    Generar ImÃ¡genes SintÃ©ticas 
    => generate_report

Step generate_report
    Generar un informe mensual 
    => end

Step end
    Fin del pipeline.
```

---


# MLOps Pipeline with Metaflow and Kubernetes

## Instructions to Run the Pipeline

### Before You Begin

1. Make sure you have downloaded the dataset files from NBIA (TCIA) to your machine.
   ([https://www.cancerimagingarchive.net/collection/lung-pet-ct-dx/](https://www.cancerimagingarchive.net/collection/lung-pet-ct-dx/))
   The file is named `Lung-PET-CT-Dx-NBIA-Manifest-122220.tcia`.
   If you are unable to download it using the *NBIA Data Retriever* tool, try using the Python library `nbiatoolkit`.

2. In the file `main_pipeline.py`, locate the following line of code:

```python
dataset_path = "../../../../ChestCT-NBIA/manifest-1608669183333"  # CHANGE THIS !!
```

3. **Important!** Change the value of `dataset_path` to the folder where the downloaded dataset files are located.

### Running the Pipeline

```bash
cd src/Pipeline
python main_pipeline.py run
```

---

## Directory Structure

```bash
ğŸ“‚ Pipeline
â”‚-- ğŸ“‚ Data                  # Data used for training
â”‚-- ğŸ“‚ GAN_PyTorch           # GAN architectures implemented in PyTorch
â”‚-- ğŸ“‚ model                 # * Trained models and checkpoints
â”‚-- ğŸ“‚ images                # * Images generated by the model
â”‚-- ğŸ“‚ evaluation            # * Evaluation files for the checkpoints
â”‚-- ğŸ“„ README.md             # This file
â”‚-- ğŸ“„ requirements.txt      # Required dependencies for running the project
â”‚-- ğŸ“„ pipeline.md           # Description of the data pipeline
â”‚-- ğŸ“„ template_EvalModel.md # Template for model evaluation
â”‚-- ğŸ“„ main_pipeline.py      # Main script of the Metaflow pipeline
â”‚-- ğŸ“„ Pipeline.png          # Pipeline diagram

Note*: Automatically generated by the pipeline
```

```bash
python3 main_pipeline.py show 
Metaflow 2.13.9 executing ChestGAN for user:palomaperezdemadrid



Step start
    Select Images for the model 
    => train_model

Step train_model
    Train the model 
    => eval_model

Step eval_model
    Evaluate the model 
    => generate_imgs

Step generate_imgs
    Generate Synthetic Images 
    => generate_report

Step generate_report
    Generate a monthly report 
    => end

Step end
    End of the pipeline.
```

