<%- include('../header') %>
<style>
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }
    th {
        background-color: #f4f4f4;
        color: #333;
    }
    tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    .btn {
        padding: 6px 12px;
        margin: 2px;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
    }
    .btn-danger {
        background-color: #e74c3c;
        color: white;
        border: none;
    }
    .btn-danger:hover {
        background-color: #c0392b;
    }
    .btn-primary {
        background-color: #3498db;
        color: white;
        border: none;
    }
    .btn-primary:hover {
        background-color: #2980b9;
    }
    .alert-info {
        background-color: #d9edf7;
        color: #31708f;
        padding: 15px;
        border-radius: 5px;
    }
    .alert-danger {
        background-color: #f2dede;
        color: #a94442;
        padding: 15px;
        border-radius: 5px;
    }
</style>
<section class="background-blue">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div class="titlepage">
                    <h2>Usuarios</h2>
                    <p>Consulta toda la información relacionada con los usuarios y accede a los detalles relevantes de manera sencilla.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mostrar el mensaje global de error si existe -->
    <% if (typeof message !== 'undefined' && message) { %>
        <div class="alert alert-info"><%= message %></div>
    <% } %>

    <!-- Mostrar un mensaje de error si hay un error específico -->
    <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger"><%= error %></div>
    <% } %>

    <!-- Users from database Start-->
    <div class="container mt-5">
        <table>
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Nombre de Usuario</th>
                    <th>Email</th>
                    <th>num_colegiado</th>
                    <th>is_admin</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
            <% messages.forEach(message => { %>
                <tr>
                <td><%= message.name %></td>
                <td><%= message.username %></td>
                <td><%= message.email %></td>
                <td><%= message.num_colegiado %></td>
                <td><%= message.is_admin %></td>
                <td>
                    <!-- Botón para editar usuario -->
                    <button class="btn btn-primary danger"  style="background-color: #2ecc71" data-toggle="modal" data-target="#editUserModal<%= message.id %>">Editar</button>

                    <!-- Modal para editar usuario -->
                    <div class="modal fade" id="editUserModal<%= message.id %>" tabindex="-1" role="dialog" aria-labelledby="editUserModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editUserModalLabel">Editar Usuario</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <!-- Mostrar mensaje de error si existe dentro del modal -->
                                <% if (typeof error !== 'undefined' && error) { %>
                                    <div class="alert alert-danger" role="alert">
                                        <%= error %>
                                    </div>
                                <% } %>
                                <form action="adminUsers/editUser/<%= message.id %>" method="POST">
                                    <div class="modal-body">
                                        <!-- Campo oculto para el id del usuario -->
                                        <input type="hidden" name="id" value="<%= message.id %>">
                                        <div class="form-group">
                                            <label for="name<%= message.id %>">Nombre:</label>
                                            <input type="text" class="form-control" id="name<%= message.id %>" name="name" value="<%= message.name %>" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="username<%= message.id %>">Nombre de Usuario:</label>
                                            <input type="text" class="form-control" id="username<%= message.id %>" name="username" value="<%= message.username %>" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="email<%= message.id %>">Email:</label>
                                            <input type="email" class="form-control" id="email<%= message.id %>" name="email" value="<%= message.email %>" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="num_colegiado<%= message.id %>">Num Colegiado:</label>
                                            <input type="text" class="form-control" id="num_colegiado<%= message.id %>" name="num_colegiado" value="<%= message.num_colegiado %>" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="is_admin<%= message.id %>">Administrador:</label>
                                            <select class="form-control" id="is_admin<%= message.id %>" name="is_admin">
                                                <option value="true" <%= message.is_admin === 'true' ? 'selected' : '' %>>Sí</option>
                                                <option value="false" <%= message.is_admin === 'false' ? 'selected' : '' %>>No</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                    </div>                                    
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Botón para eliminar usuario -->
                    <form action="adminUsers/deleteUser" method="POST" style="display:inline;">
                        <input type="hidden" name="id" value="<%= message.id %>">
                        <button type="submit" class="btn btn-danger">Eliminar</button>
                    </form>
                    
                    <!-- Enlace para enviar un correo de respuesta -->
                    <a href="mailto:<%= message.email %>?subject=Respuesta%20a%20tu%20mensaje&body=Hola%2C%20gracias%20por%20tu%20mensaje.%20Aquí%20está%20mi%20respuesta.%20[Escribe%20aquí%20tu%20respuesta]">
                        <button class="btn btn-primary">Enviar Email</button>
                    </a>
                </td>
                </tr>
            <% }); %>
            </tbody>
        </table>
    </div>
</section>

<%- include('../footer') %>
